SELECT
	TITMTMV.CODCOLIGADA,
	CASE TTMV.CLASSIFICACAO		WHEN '04.04.04' THEN 'Estoque > Requisi巫o de Material'		WHEN '04.04.05' THEN 'Estoque > Baixa de Estoque'		WHEN '04.04.06' THEN 'Estoque > Transfer沙cias'		WHEN '04.04.08' THEN 'Estoque > Produ巫o > Movimenta巫o'		WHEN '04.04.10' THEN 'Estoque > Estoque de Terceiros'		WHEN '04.06.01' THEN 'Compras > Solicita巫o de Compra'		WHEN '04.06.02' THEN 'Compras > Cota巫o'		WHEN '04.06.04' THEN 'Compras > Ordem de Compras'		WHEN '04.06.05' THEN 'Compras > Recebimento de Materiais'		WHEN '04.06.06' THEN 'Compras > Importa巫o'		WHEN '04.06.07' THEN 'Compras > Aquisi巫o de Servi每s'		WHEN '04.06.08' THEN 'Compras > Devolu巫o de Compras'		WHEN '04.07'    THEN 'Outras Movimenta貿es > Controle de Imobilizado'		WHEN '04.08.01' THEN 'Vendas > Pedido de Vendas'		WHEN '04.08.02' THEN 'Vendas > Faturamento > Movimenta巫o'		WHEN '04.08.03' THEN 'Vendas > Exporta貿es'		WHEN '04.08.04' THEN 'Vendas > Devolu巫o de Vendas'		WHEN '04.09'    THEN 'Outras Movimenta貿es > Outras Movimenta貿es'		ELSE TTMV.CLASSIFICACAO + ' - A localizar'
	END																																							AS 'MENU_LOCAL', 
	TITMTMV.CODTMV																																				AS 'CODTMV', 
	    CASE 
        WHEN TITMTMV.EFEITOSALDOORCA = 'T' THEN 'AUMENTA O COMPROMETIDO' 
        WHEN TITMTMV.EFEITOSALDOORCA = 'N' THEN 'NENHUM EFEITO NO OR큐MENTO' 
        WHEN TITMTMV.EFEITOSALDOORCA = 'M' THEN 'AUMENTA O EMPENHADO' 
        WHEN TITMTMV.EFEITOSALDOORCA = 'D' THEN 'DIMINUI O REALIZADO' 
        WHEN TITMTMV.EFEITOSALDOORCA = 'A' THEN 'AUMENTA O REALIZADO' 
    END																																							AS 'EFEITO NO SALDO DO OR큐MENTO',
	TTMV.NOME																																					AS 'NOME',
	CASE WHEN TITMTMV.HABILITAORCAMENTO = 1 THEN 'ATIVO' ELSE 'INATIVO' END AS 'HABILITA OR큐MENTO',
    CASE WHEN TTMVEXT.BUSCARNATORCDEFAULTPRD = 'D' THEN 'DESPESA' 
		 WHEN TTMVEXT.BUSCARNATORCDEFAULTPRD = 'R' THEN 'RECEITA' 
		 ELSE TTMVEXT.BUSCARNATORCDEFAULTPRD							
	END																																							AS 'BUSCAR DEFAULT DO PRODUTO',
	 CASE 
        WHEN TITMTMV.LIMESTOUROORCAMENTO = 'A' THEN 'AVISA' 
        WHEN TITMTMV.LIMESTOUROORCAMENTO = 'L' THEN 'BLOQUEIA' 
    END																																							AS 'LIMITE DE ESTOURO DO OR큐MENTO',
	CASE TTMV.CONTABILLAN
		WHEN 'N' THEN 'N交 Cont庚il'
		WHEN 'B' THEN 'Baixa Cont庚il'
		WHEN 'C' THEN 'Cont庚il'
		WHEN 'A' THEN 'A Contabilizar'
		ELSE 'Sem parametriza巫o'
	END																																							AS 'CONT_FINANCEIRO',
	CONVERT(VARCHAR(15), (SELECT MAX(TMOV.DATAEMISSAO) FROM TMOV WITH (NOLOCK) WHERE TMOV.CODCOLIGADA = TTMV.CODCOLIGADA AND TMOV.CODTMV = TTMV.CODTMV), 103)	AS 'ULTIMO_MOVIMENTO'

FROM 
				TITMTMV			WITH (NOLOCK)
	JOIN		TTMV			WITH (NOLOCK) ON TTMV.CODCOLIGADA = TITMTMV.CODCOLIGADA AND TTMV.CODTMV = TITMTMV.CODTMV
	JOIN		TTMVEXT			WITH (NOLOCK) ON TTMVEXT.CODCOLIGADA = TTMV.CODCOLIGADA AND TTMVEXT.CODTMV = TTMV.CODTMV
	LEFT JOIN	TMOTIVOREFMOV	WITH (NOLOCK) ON TMOTIVOREFMOV.CODCOLIGADA = TTMVEXT.CODCOLIGADA AND TMOTIVOREFMOV.IDMOTIVOREF = TTMVEXT.IDMOTIVOREF

WHERE 
		1=1
	AND TITMTMV.CODCOLIGADA IN (1, 2)
--	AND TITMTMV.CODTMV LIKE '1.2.%'
--	AND TITMTMV.EFEITOSALDOORCA <> 'A'

ORDER BY 
	TITMTMV.CODCOLIGADA,
	TITMTMV.CODTMV
